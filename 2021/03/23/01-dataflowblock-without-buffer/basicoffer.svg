<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1144px" preserveAspectRatio="none" style="width:492px;height:1144px;" version="1.1" viewBox="0 0 492 1144" width="492px" zoomAndPan="magnify"><defs><filter height="300%" id="f1ijvt5682xnvg" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f1ijvt5682xnvg)" height="243.9297" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="112" y="112.5625"/><rect fill="#FFFFFF" filter="url(#f1ijvt5682xnvg)" height="341.3281" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="112" y="428.7578"/><rect fill="#FFFFFF" filter="url(#f1ijvt5682xnvg)" height="68.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="117" y="565.2891"/><rect fill="#FFFFFF" filter="url(#f1ijvt5682xnvg)" height="107.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="112" y="910.6172"/><rect fill="#FFFFFF" filter="url(#f1ijvt5682xnvg)" height="107.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="395" y="180.8281"/><rect fill="#FFFFFF" filter="url(#f1ijvt5682xnvg)" height="204.7969" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="395" y="497.0234"/><rect fill="#FFFFFF" filter="url(#f1ijvt5682xnvg)" height="243.9297" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="395" y="842.3516"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="116.5" x2="116.5" y1="38.2969" y2="1104.2813"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="399.5" x2="399.5" y1="38.2969" y2="1104.2813"/><rect fill="#FEFECE" filter="url(#f1ijvt5682xnvg)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="63" x="83.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="49" x="90.5" y="22.9951">Source</text><rect fill="#FEFECE" filter="url(#f1ijvt5682xnvg)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="63" x="83.5" y="1103.2813"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="49" x="90.5" y="1123.2764">Source</text><rect fill="#FEFECE" filter="url(#f1ijvt5682xnvg)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="59" x="368.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="45" x="375.5" y="22.9951">Target</text><rect fill="#FEFECE" filter="url(#f1ijvt5682xnvg)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="59" x="368.5" y="1103.2813"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="45" x="375.5" y="1123.2764">Target</text><rect fill="#FFFFFF" filter="url(#f1ijvt5682xnvg)" height="243.9297" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="112" y="112.5625"/><rect fill="#FFFFFF" filter="url(#f1ijvt5682xnvg)" height="341.3281" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="112" y="428.7578"/><rect fill="#FFFFFF" filter="url(#f1ijvt5682xnvg)" height="68.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="117" y="565.2891"/><rect fill="#FFFFFF" filter="url(#f1ijvt5682xnvg)" height="107.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="112" y="910.6172"/><rect fill="#FFFFFF" filter="url(#f1ijvt5682xnvg)" height="107.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="395" y="180.8281"/><rect fill="#FFFFFF" filter="url(#f1ijvt5682xnvg)" height="204.7969" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="395" y="497.0234"/><rect fill="#FFFFFF" filter="url(#f1ijvt5682xnvg)" height="243.9297" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="395" y="842.3516"/><rect fill="#EEEEEE" filter="url(#f1ijvt5682xnvg)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="477" x="3" y="68.8633"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="480" y1="68.8633" y2="68.8633"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="480" y1="71.8633" y2="71.8633"/><rect fill="#EEEEEE" filter="url(#f1ijvt5682xnvg)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="84" x="199.5" y="58.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="65" x="205.5" y="74.3638">単純な送信</text><polygon fill="#A80036" points="100,108.5625,110,112.5625,100,116.5625,104,112.5625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3" x2="106" y1="112.5625" y2="112.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="10" y="107.4966">Start</text><path d="M42,125.5625 L42,150.5625 L188,150.5625 L188,135.5625 L178,125.5625 L42,125.5625 " fill="#FBFB77" filter="url(#f1ijvt5682xnvg)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M178,125.5625 L178,135.5625 L188,135.5625 L178,125.5625 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="125" x="48" y="142.6294">Enter OutgoingLock</text><polygon fill="#A80036" points="383,176.8281,393,180.8281,383,184.8281,387,180.8281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="122" x2="389" y1="180.8281" y2="180.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="254" x="129" y="175.7622">OfferMessage(consumeToAccept: false)</text><path d="M325,193.8281 L325,218.8281 L471,218.8281 L471,203.8281 L461,193.8281 L325,193.8281 " fill="#FBFB77" filter="url(#f1ijvt5682xnvg)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M461,193.8281 L461,203.8281 L471,203.8281 L461,193.8281 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="125" x="331" y="210.895">Enter IncomingLock</text><path d="M330,232.9609 L330,257.9609 L465,257.9609 L465,242.9609 L455,232.9609 L330,232.9609 " fill="#FBFB77" filter="url(#f1ijvt5682xnvg)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M455,232.9609 L455,242.9609 L465,242.9609 L455,232.9609 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="336" y="250.0278">Exit IncomingLock</text><polygon fill="#A80036" points="133,284.2266,123,288.2266,133,292.2266,129,288.2266" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="127" x2="399" y1="288.2266" y2="288.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="139" y="283.1606">Accepted</text><path d="M47,301.2266 L47,326.2266 L182,326.2266 L182,311.2266 L172,301.2266 L47,301.2266 " fill="#FBFB77" filter="url(#f1ijvt5682xnvg)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M172,301.2266 L172,311.2266 L182,311.2266 L172,301.2266 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="53" y="318.2935">Exit OutgoingLock</text><polygon fill="#A80036" points="14,352.4922,4,356.4922,14,360.4922,10,356.4922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="8" x2="116" y1="356.4922" y2="356.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="20" y="351.4263">End</text><rect fill="#EEEEEE" filter="url(#f1ijvt5682xnvg)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="477" x="3" y="385.0586"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="480" y1="385.0586" y2="385.0586"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="480" y1="388.0586" y2="388.0586"/><rect fill="#EEEEEE" filter="url(#f1ijvt5682xnvg)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="292" x="95.5" y="374.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="273" x="101.5" y="390.5591">受信を確定する前に、再確認をしてほしい場合</text><polygon fill="#A80036" points="100,424.7578,110,428.7578,100,432.7578,104,428.7578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3" x2="106" y1="428.7578" y2="428.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="10" y="423.6919">Start</text><path d="M42,441.7578 L42,466.7578 L188,466.7578 L188,451.7578 L178,441.7578 L42,441.7578 " fill="#FBFB77" filter="url(#f1ijvt5682xnvg)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M178,441.7578 L178,451.7578 L188,451.7578 L178,441.7578 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="125" x="48" y="458.8247">Enter OutgoingLock</text><polygon fill="#A80036" points="383,493.0234,393,497.0234,383,501.0234,387,497.0234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="122" x2="389" y1="497.0234" y2="497.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="129" y="491.9575">OfferMessage(consumeToAccept: true)</text><path d="M325,510.0234 L325,535.0234 L471,535.0234 L471,520.0234 L461,510.0234 L325,510.0234 " fill="#FBFB77" filter="url(#f1ijvt5682xnvg)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M461,510.0234 L461,520.0234 L471,520.0234 L461,510.0234 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="125" x="331" y="527.0903">Enter IncomingLock</text><polygon fill="#A80036" points="138,561.2891,128,565.2891,138,569.2891,134,565.2891" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="132" x2="394" y1="565.2891" y2="565.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="144" y="560.2231">ConsumeMessage</text><path d="M8,578.2891 L8,603.2891 L222,603.2891 L222,588.2891 L212,578.2891 L8,578.2891 " fill="#FBFB77" filter="url(#f1ijvt5682xnvg)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M212,578.2891 L212,588.2891 L222,588.2891 L212,578.2891 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="193" x="14" y="595.356">Already entered OutgoingLock</text><polygon fill="#A80036" points="383,629.5547,393,633.5547,383,637.5547,387,633.5547" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="122" x2="389" y1="633.5547" y2="633.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="129" y="628.4888">messageConsumed: true</text><path d="M330,646.5547 L330,671.5547 L465,671.5547 L465,656.5547 L455,646.5547 L330,646.5547 " fill="#FBFB77" filter="url(#f1ijvt5682xnvg)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M455,646.5547 L455,656.5547 L465,656.5547 L455,646.5547 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="336" y="663.6216">Exit IncomingLock</text><polygon fill="#A80036" points="133,697.8203,123,701.8203,133,705.8203,129,701.8203" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="127" x2="399" y1="701.8203" y2="701.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="139" y="696.7544">Accepted</text><path d="M47,714.8203 L47,739.8203 L182,739.8203 L182,724.8203 L172,714.8203 L47,714.8203 " fill="#FBFB77" filter="url(#f1ijvt5682xnvg)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M172,714.8203 L172,724.8203 L182,724.8203 L172,714.8203 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="53" y="731.8872">Exit OutgoingLock</text><polygon fill="#A80036" points="14,766.0859,4,770.0859,14,774.0859,10,770.0859" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="8" x2="116" y1="770.0859" y2="770.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="20" y="765.02">End</text><rect fill="#EEEEEE" filter="url(#f1ijvt5682xnvg)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="477" x="3" y="798.6523"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="480" y1="798.6523" y2="798.6523"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="480" y1="801.6523" y2="801.6523"/><rect fill="#EEEEEE" filter="url(#f1ijvt5682xnvg)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="240" x="121.5" y="788.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="221" x="127.5" y="804.1528">延期したメッセージを再受信する場合</text><polygon fill="#A80036" points="416,838.3516,406,842.3516,416,846.3516,412,842.3516" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="410" x2="479" y1="842.3516" y2="842.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="422" y="837.2856">Start</text><path d="M325,855.3516 L325,880.3516 L471,880.3516 L471,865.3516 L461,855.3516 L325,855.3516 " fill="#FBFB77" filter="url(#f1ijvt5682xnvg)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M461,855.3516 L461,865.3516 L471,865.3516 L461,855.3516 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="125" x="331" y="872.4185">Enter IncomingLock</text><polygon fill="#A80036" points="133,906.6172,123,910.6172,133,914.6172,129,910.6172" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="127" x2="394" y1="910.6172" y2="910.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="139" y="905.5513">ConsumeMessage</text><path d="M42,923.6172 L42,948.6172 L188,948.6172 L188,933.6172 L178,923.6172 L42,923.6172 " fill="#FBFB77" filter="url(#f1ijvt5682xnvg)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M178,923.6172 L178,933.6172 L188,933.6172 L178,923.6172 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="125" x="48" y="940.6841">Enter OutgoingLock</text><path d="M47,962.75 L47,987.75 L182,987.75 L182,972.75 L172,962.75 L47,962.75 " fill="#FBFB77" filter="url(#f1ijvt5682xnvg)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M172,962.75 L172,972.75 L182,972.75 L172,962.75 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="53" y="979.8169">Exit OutgoingLock</text><polygon fill="#A80036" points="383,1014.0156,393,1018.0156,383,1022.0156,387,1018.0156" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="117" x2="389" y1="1018.0156" y2="1018.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="124" y="1012.9497">messageConsumed: true</text><path d="M330,1031.0156 L330,1056.0156 L465,1056.0156 L465,1041.0156 L455,1031.0156 L330,1031.0156 " fill="#FBFB77" filter="url(#f1ijvt5682xnvg)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M455,1031.0156 L455,1041.0156 L465,1041.0156 L455,1031.0156 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="336" y="1048.0825">Exit IncomingLock</text><polygon fill="#A80036" points="468,1082.2813,478,1086.2813,468,1090.2813,472,1086.2813" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="400" x2="474" y1="1086.2813" y2="1086.2813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="407" y="1081.2153">End</text><!--
@startuml
participant Source
participant Target

== 単純な送信 ==

[-> Source : Start
activate Source

note over Source : Enter OutgoingLock

Source -> Target : OfferMessage(consumeToAccept: false)
activate Target

note over Target : Enter IncomingLock
note over Target : Exit IncomingLock

Target -> Source : Accepted
deactivate Target

note over Source : Exit OutgoingLock

[<- Source : End
deactivate Source

== 受信を確定する前に、再確認をしてほしい場合 ==

[-> Source : Start
activate Source

note over Source : Enter OutgoingLock

Source -> Target : OfferMessage(consumeToAccept: true)
activate Target

note over Target : Enter IncomingLock

Target -> Source : ConsumeMessage
activate Source

note over Source : Already entered OutgoingLock

Source -> Target : messageConsumed: true
deactivate Source

note over Target : Exit IncomingLock

Target -> Source : Accepted
deactivate Target

note over Source : Exit OutgoingLock

[<- Source : End
deactivate Source

== 延期したメッセージを再受信する場合 ==

Target <-] : Start
activate Target

note over Target : Enter IncomingLock

Target -> Source : ConsumeMessage
activate Source

note over Source : Enter OutgoingLock
note over Source : Exit OutgoingLock

Source -> Target : messageConsumed: true
deactivate Source

note over Target : Exit IncomingLock

Target ->] : End
deactivate Target

@enduml

PlantUML version 1.2018.13(Tue Nov 27 02:11:51 JST 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.10+9-Ubuntu-0ubuntu1.20.04
Operating System: Linux
OS Version: 5.4.72-microsoft-standard-WSL2
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>